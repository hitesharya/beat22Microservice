{
  "openapi": "3.0.0",
  "info": {
    "title": "Express Auth API",
    "version": "1.0.0",
    "description": "API documentation for Express.js authentication and user profile system"
  },
  "servers": [
    {
      "url": "http://localhost:4000"
    }
  ],
  "paths": {

"/files/upload-single-small-file": {
      "post": {
        "summary": "Upload one or more images to S3",
        "tags": ["Small file upload without multipart"],
         "security": [
      {
        "accessTokenHeader": []
      }
    ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "image": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    },
                    "description": "One or more image files"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File(s) uploaded successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "integer",
                      "example": 201
                    },
                    "message": {
                      "type": "string",
                      "example": "File(s) uploaded successfully"
                    },
                    "fileUrls": {
                      "oneOf": [
                        {
                          "type": "string",
                          "example": "https://img-motorwash.s3.ap-south-1.amazonaws.com/image.jpg"
                        },
                        {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "example": "https://img-motorwash.s3.ap-south-1.amazonaws.com/image1.jpg"
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },



    "/files/upload-full": {
  "post": {

      "tags": ["Large  file multipart upload in chuncks from backend all process"],

    "summary": " Upload a large file directly via backend-managed multipart upload to AWS S3",
      "description": 
      "This endpoint allows clients to upload large files in a single HTTP POST request. The backend handles breaking the file into chunks and uploads it to AWS S3 using the multipart upload API. Suitable for files up to 2GB. This method does not use presigned URLs, and the client does not need to handle chunking.",
     "security": [
      {
        "accessTokenHeader": []
      }
    ],
    "requestBody": {
      "required": true,
      "content": {
        "multipart/form-data": {
          "schema": {
            "type": "object",
            "properties": {
              "file": {
                "type": "string",
                "format": "binary"
              }
            },
            "required": ["file"]
          }
        }
      }
    },
    "responses": {
      "200": {
        "description": "File uploaded successfully",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string"
                },
                "fileId": {
                  "type": "string"
                },
                "location": {
                  "type": "string",
                  "format": "uri"
                }
              }
            }
          }
        }
      },
      "400": {
        "description": "Bad Request"
      },
      "500": {
        "description": "Server Error"
      }
    }
  }
},





     "/files/initiate": {
      "post": {
          "tags": ["Large  file multipart upload using preSignedUrl from client application  depedencies"],
        "summary": "Initiate a multipart file upload",
         "security": [
      {
        "accessTokenHeader": []
      }
    ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["filename", "size"],
                "properties": {
                  "filename": {
                    "type": "string",
                    "example": "video.mp4"
                  },
                  "size": {
                    "type": "integer",
                    "example": 10485760
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Upload initiated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "uploadId": {
                      "type": "string",
                      "example": "abc123"
                    },
                    "parts": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "partNumber": {
                            "type": "integer",
                            "example": 1
                          },
                          "presignedUrl": {
                            "type": "string",
                            "format": "uri",
                            "example": "https://s3.amazonaws.com/bucket/file?partNumber=1"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/files/complete": {


      "post": {
          "tags": ["Large  file multipart upload using preSignedUrl from client application  depedencies"],

        "summary": "Complete the multipart upload",

         "security": [
      {
        "accessTokenHeader": []
      }
    ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["uploadId", "parts"],
                "properties": {
                  "uploadId": {
                    "type": "string",
                    "example": "abc123"
                  },
                  "parts": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["partNumber", "eTag"],
                      "properties": {
                        "partNumber": {
                          "type": "integer",
                          "example": 1
                        },
                        "eTag": {
                          "type": "string",
                          "example": "\"etag-example\""
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Upload completed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "fileId": {
                      "type": "string",
                      "example": "64b70d1d1d1234abc1234567"
                    },
                    "location": {
                      "type": "string",
                      "format": "uri",
                      "example": "https://s3.amazonaws.com/bucket/final_file.mp4"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/files/{fileId}": {
      "get": {
        "tags": ["Large  file multipart upload using preSignedUrl from client application  depedencies"],

        "summary": "Get a presigned URL to download the file",
         "security": [
      {
        "accessTokenHeader": []
      }
    ],
        "parameters": [
          {
            "name": "fileId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "example": "64b70d1d1d1234abc1234567"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Presigned download URL returned",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "downloadUrl": {
                      "type": "string",
                      "format": "uri",
                      "example": "https://s3.amazonaws.com/bucket/final_file.mp4"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "File not found"
          }
        }
      }
    }


    

  },
  "components": {
    "schemas": {
      "RegisterInput": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string", "format": "password" },
          "address": { "type": "string" },
          "profileImage": { "type": "string" }
        },
        "required": ["name", "email", "password"]
      },
      "LoginInput": {
        "type": "object",
        "properties": {
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string", "format": "password" }
        },
        "required": ["email", "password"]
      },

      "UpdateProfileInput": {
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "example": "John Doe"
    },
    "address": {
      "type": "string",
      "example": "jaipur rajasthan"
    },
    "profileImage": {
      "type": "string",
      "example": "image_url"
    }
  },
  "description": "At least one field must be provided to update profile"
},
"UserResponse": {
  "type": "object",
  "properties": {
    "_id": {
      "type": "string",
      "example": "64f9916bcfdd3b123abc4567"
    },
    "name": {
      "type": "string",
      "example": "John Doe"
    },
    "email": {
      "type": "string",
      "example": "john@example.com"
    },
    "__v": {
      "type": "integer",
      "example": 0
    }
  }
}

    },
"securitySchemes": {
  "accessTokenHeader": {
    "type": "apiKey",
    "in": "header",
    "name": "Authorization",
    "description": "Enter your JWT token as plain string (no 'Bearer' prefix)"
  }
}
  }
}
